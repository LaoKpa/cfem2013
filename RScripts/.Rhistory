library(aod)
library(fBasics)
library(car)
setwd("/Users/JiaXu/Documents/FE Project")
source("parser.R")
a <- h5read("ticks.20130423.h5", "/ticks/AMZN", bit64conversion='double')
quotes <- a[a$type == 'Q',unlist(strsplit("time|latency|symbol|refresh|bid_exchange|ask_exchange|exchange_time|bid_size|bid|ask|ask_size|quals|seq_no|instrument_status|prev_close", "\\|"))]
trades <- a[a$type == 'T',unlist(strsplit("time|latency|symbol|exchange|exchange_time|seq_no|price|size|volume|quals|market_status|instrument_status|thru_exempt|sub_market|line|type", "\\|"))]
L <- 50
fixed_bin <- 200
bucket_size <- seq(1000,1000,50000)
bucket_size
bucket_size <- seq(1000,50000,1000)
bucket_size
head(trades)
basicStats(trades)
basicStats(trades)
basicStats(trades$volume)
2.270014e+06
plot(density(trades$volume))
plot(density(trades$size))
basicStats(trades$size)
trades$size>20000
sum(trades$size)
sum(trades$size>2000)
sum(trades$size>20000)
sum(trades$size>1000)
dim(trades)[1,]
dim(trades)[1]
length(trades$size)
sum(trades$size>5000)
sum(trades$size>2000)
which(trades$size>2000)
bucket_size <- 1000
which(a$size>2000)
quotes$size
trades$size
quotes$size
sum(trades$size > 2000)
sum(a$size > 2000)
which(a$size>2000)
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T)
time_bin <- 60
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T)
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,2],SOI_buckets_delta_prices[,1])
summary(lm1)
plot_model_stat<-function(xs,ys,yylab = "y",mmain = ""){
one_factor_model <- lm(ys~xs)
print(summary(one_factor_model))
plot(xs, ys,ylab=yylab,main=mmain)
abline(lm(ys~xs),col="red")
return(one_factor_model)
}
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
SOI_buckets_delta_prices[,1]
setwd("/Users/JiaXu/Documents/FE Project 2013")
source("parser.R")
setwd("/Users/JiaXu/Documents/FE project 2013/RScripts")
source("parser.R")
a <- h5read("ticks.20130423.h5", "/ticks/AMZN", bit64conversion='double')
quotes <- a[a$type == 'Q',unlist(strsplit("time|latency|symbol|refresh|bid_exchange|ask_exchange|exchange_time|bid_size|bid|ask|ask_size|quals|seq_no|instrument_status|prev_close", "\\|"))]
trades <- a[a$type == 'T',unlist(strsplit("time|latency|symbol|exchange|exchange_time|seq_no|price|size|volume|quals|market_status|instrument_status|thru_exempt|sub_market|line|type", "\\|"))]
fixed_bin <- 200
bucket_size <- 1000
L <- 50
time_bin <- 60
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
summary(lm1)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
lm5 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]+SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3])
plot(SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,2])
abline(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,3]),col="red")
summary(lm5)
residualPlots(lm5)
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T, T, T, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
summary(lm1)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
lm5 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]+SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3])
plot(SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,2])
abline(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,3]),col="red")
source("parser.R")
source("parser.R")
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T, T, T, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
SOI_buckets_delta_prices[,1]
summary(SOI_buckets_delta_prices[,1])
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
source("parser.R")
source("parser.R")
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
source("parser.R")
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T, T, T, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>1000),],bucket_size, F, L, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
length(SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[1:2048,1],SOI_buckets_delta_prices[2:2049,2])
plot_model_stat(SOI_buckets_delta_prices[1:2048,1],SOI_buckets_delta_prices[1:2048,2])
source("parser.R")
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>2000),],bucket_size, F, L, T, T, T, T)
plot_model_stat(SOI_buckets_delta_prices[1:2048,1],SOI_buckets_delta_prices[1:2048,2])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
length(SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[1:2096,1],SOI_buckets_delta_prices[2:2097,2])
source("parser.R")
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
s<-lm(SOI_buckets_delta_prices[3:2097,2]~SOI_buckets_delta_prices[2:2096,1]+SOI_buckets_delta_prices[1:2095,1])
summary(s)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
mm <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]+SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
summary(mm)
mm <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]+SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
summary(mm)
mm <-lm(SOI_buckets_delta_prices[,2]~OI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
mm <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
summary(mm)
bucket_size <- 3000
time_bin <- 60
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm5 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
plot(SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,2])
abline(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,3]),col="red")
summary(lm5)
residualPlots(lm5)
summary(lm5)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
summary(lm1)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
lm10 <-lm(SOI_buckets_delta_prices[-1,2]~SOI_buckets_delta_prices[-nnn,1])
nnn = length(SOI_buckets_delta_prices[,2])
lm10 <-lm(SOI_buckets_delta_prices[-1,2]~SOI_buckets_delta_prices[-nnn,1])
summary(lm10)
bucket_size <- 5000
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
summary(lm1)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
bucket_size <- 3000
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>3000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
bucket_size <- 2000
bucket_size <- 3000
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
bucket_size <- 3000
time_bin <- 30
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
- 3000
bucket_size <- 3000
time_bin <- 120
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
bucket_size <- 3000
time_bin <- 90
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
bucket_size <- 2000
time_bin <- 90
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>2000),],bucket_size, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
time <- seq(15,120,15)
time
bucket <- seq(1000,50000,1000)
time <- seq(15,120,15)
bucket <- seq(1000,50000,1000)
l_time <- length(time)
l_buket <- length(bucket)
thres <- seq(1000,5000,1000)
l_thres <- length(thres)
len <- l_time*l_buket*l_thres
time <- seq(15,120,15)
bucket <- seq(1000,10000,1000)
l_time <- length(time)
l_buket <- length(bucket)
thres <- seq(1000,5000,1000)
l_thres <- length(thres)
m<-paste("I ", " AM ", "HIGH")
m
l_time
l_buket
l_thres
R2 <- zeros(len,2)
R2 <- rep(0,len,2)
R2
R2 <- ones(len,2)
R2 <- rep(0,len,2)
R2
KEY <- rep("",len)
KEY
R2_0 <- rep(0,len)
R2_0
R2 <- data.frame(KEY,R2_0)
head)R2
head(R2)
R["hi"]=1
bb=c()
bb["hi"]=1
bb["lalala"]=2
bb
summary(lm1)
names(summary(lm1))
time <- 30
bucket <- 2000
l_thres <- 2000
l_time <- length(time)
l_buket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres),],bucket_size, F, L, T)
R2[paste(i,"_",j,"_",k)] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
time <- 30
bucket <- 2000
l_thres <- 2000
l_time <- length(time)
l_bucket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres),],bucket_size, F, L, T)
R2[paste(i,"_",j,"_",k)] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
bucket <- 3000
l_thres <- 2000
time <- 60
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres),],bucket_size, F, L, T)
time <- 60
bucket <- 3000
thres <- 2000
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres),],bucket_size, F, L, T)
R2
time <- 60
bucket <- 3000
thres <- 2000
l_time <- length(time)
l_bucket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres1 <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres1),],bucket_size, F, L, T)
R2[paste(bucket[i],"_",time[j],"_",thres[k])] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
R2
time <- seq(15,150,15)
bucket <- seq(1000,10000,1000)
thres <- seq(1000,5000,1000)
l_time <- length(time)
l_bucket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres1 <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres1),],bucket_size, F, L, T)
R2[paste(bucket[i],"_",time[j],"_",thres[k])] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
R2
names(R2)
max(R2)
which(R2=max(R2))
which(R2==max(R2))
max(R2)
save.image("~/Documents/FE Project/Predict 1.RData")
time <- seq(15,150,15)
bucket <- seq(1000,10000,1000)
thres <- seq(1000,5000,1000)
l_time <- length(time)
l_bucket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres1 <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>thres1),],bucket_size, F, L, T, T, T, T)
#SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres1),],bucket_size, F, L, T)
R2[paste(bucket[i],"_",time[j],"_",thres[k])] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
time <- seq(30,150,30)
bucket <- seq(1000,10000,1000)
thres <- seq(1000,5000,2000)
l_time <- length(time)
l_bucket <- length(bucket)
l_thres <- length(thres)
R2 <- c()
for(i in 1:l_bucket){
for(j in 1:l_time){
for( k in 1:l_thres){
bucket_size <- bucket[i]
time_bin <- time[j]
thres1 <- thres[k]
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,a[-which(a$size>thres1),],bucket_size, F, L, T, T, T, T)
#SOI_buckets_delta_prices <- calc_OI_by_time_buckets(time_bin,trades[-which(trades$size>thres1),],bucket_size, F, L, T)
R2[paste(bucket[i],"_",time[j],"_",thres[k])] = summary(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]))$r.squared
}
}
}
R2
save.image("~/Documents/FE Project/with quotes result.RData")
max(R2)
which(R2==max(R2))
save.image("~/Documents/FE Project/with quotes result1.RData")
load("~/Documents/FE Project/Predict 1.RData")
R2
which(R2==max(R2))
SOI_buckets_delta_prices <- calc_OI_by_time_buckets(135,trades[-which(trades$size>1000),],10000, F, L, T)
lm1 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1])
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
summary(lm1)
lm5 <-lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3])
plot(SOI_buckets_delta_prices[,1]*
SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,2])
abline(lm(SOI_buckets_delta_prices[,2]~SOI_buckets_delta_prices[,3]),col="red")
summary(lm5)
pairs(SOI_buckets_delta_prices[,2],SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,1])
?pairs
pairs(data.frame(SOI_buckets_delta_prices[,2],SOI_buckets_delta_prices[,1]*SOI_buckets_delta_prices[,3],SOI_buckets_delta_prices[,1])
)
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2])
plot_model_stat<-function(xs, ys,xlabb="x",ylabb="y",mmain =""){
one_factor_model <- lm(ys~xs)
print(summary(one_factor_model))
plot(xs, ys,xlab=xlabb,ylab=ylabb,main=mmain)
abline(lm(ys~xs))
return(one_factor_model)
}
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2],"SOI","Bucket simple return","Lee Ready")
plot_model_stat(SOI_buckets_delta_prices[,1],SOI_buckets_delta_prices[,2],"SOI","Bucket simple return","LeeReady Concurrent period with bucket size=10,000, time bin=135s, exclude trades with size > 1000")
l_prices = length(SOI_buckets_delta_prices[,2])
lm1 <-lm(SOI_buckets_delta_prices[-1,2]~SOI_buckets_delta_prices[-l_prices,1])
summary(lm1)
c(l_prices,l_prices-1)
lm1 <-lm(SOI_buckets_delta_prices[-c(1,2),2]~SOI_buckets_delta_prices[-c(l_prices,l_prices-1),1]+
SOI_buckets_delta_prices[-c(1,l_prices),1])
summary(lm1)
pairs(data.frame(SOI_buckets_delta_prices[-c(1,2),2],SOI_buckets_delta_prices[-c(l_prices,l_prices-1),1]+
SOI_buckets_delta_prices[-c(1,l_prices),1]))
pairs(data.frame(SOI_buckets_delta_prices[-c(1,2),2],SOI_buckets_delta_prices[-c(l_prices,l_prices-1),1],
SOI_buckets_delta_prices[-c(1,l_prices),1]))
